
// -- user code here --

/* --- start generated code --- */

// Generated by  1.5.2 (Phaser v2.6.2)


/**
 * PrefabChar6B
 * @param {Phaser.Game} aGame A reference to the currently running game.
 * @param {Number} aX The x coordinate (in world space) to position the Sprite at.
 * @param {Number} aY The y coordinate (in world space) to position the Sprite at.
 * @param {any} aKey This is the image or texture used by the Sprite during rendering. It can be a string which is a reference to the Cache entry, or an instance of a RenderTexture or PIXI.Texture.
 * @param {any} aFrame If this Sprite is using part of a sprite sheet or texture atlas you can specify the exact frame to use by giving a string or numeric index.
 */
function PrefabChar6B(aGame, aX, aY, aKey, aFrame) {
	Phaser.Sprite.call(this, aGame, aX, aY, aKey || 'Char6BSheet', aFrame == undefined || aFrame == null? 0 : aFrame);

	this._UP = this.animations.add('UP', [9, 10, 11, 12, 13, 14, 0], 10, false);
	this._UP.onComplete.add(this.animComplete, this);
	
	this._IDLE = this.animations.add('IDLE', [0, 1, 2, 3, 4, 5, 6, 7, 8, 1], 10, true);
	
	this._DOWN = this.animations.add('DOWN', [0, 15, 16, 17, 17, 18, 19, 20, 21], 10, false);
	this._DOWN.onComplete.add(this.animHideComplete, this);
	
	this._HIT = this.animations.add('HIT', [24], 3, true);
	this._HIT_DOWN = this.animations.add('HIT_DOWN', [24, 25, 26], 10, false);
	this._HIT_DOWN.onComplete.add(this.fadeOut, this);
	this._HIT_FEAR = this.animations.add('HIT_FEAR', [22, 23], 5, true);
	
	this.anchor.setTo(0.48, 0.76);
	this.visible = false;
	
	this.charWord = "";
	
	// 190313 add
	this.isIdle = false;	// 캐릭터 idle상태 체크
	
	this.that = aGame;

}

/** @type Phaser.Sprite */
var PrefabChar6B_proto = Object.create(Phaser.Sprite.prototype);
PrefabChar6B.prototype = PrefabChar6B_proto;
PrefabChar6B.prototype.constructor = PrefabChar6B;

/* --- end generated code --- */
// -- user code here --

PrefabChar6B.prototype.charUp = function(_idx, _showTime) {
	if (mEffectMute == false) {
		esIn.play();
	}
	
	this.visible = true;
	this._UP.play();
	
	this.idx = _idx;

	// 190313 add
	// 상태 변경 추가
	this.isIdle = false;
	
	// 등장해서 존재할 시간 셋팅
	var _rnd;
	if (_showTime.min != _showTime.max) {
		_rnd = this.game.rnd.integerInRange(_showTime.min, _showTime.max);
	}
	else {
		_rnd = _showTime.max;
	}
	
	// 몇초 후 사라질지 이벤트 등록
	this.charEvent = this.game.time.events.repeat(_rnd*1000, 1, this.hide, this);
};

PrefabChar6B.prototype.hitFear = function() {
	this.visible = true;
	this._IDLE.stop();
	this._HIT_FEAR.play();
	
	// 2017-07-08 delete
	// 190313 add
	// 상태 변경 추가
//	this.isIdle = false;
	
	this.game.state.getCurrentState().wordPanel.children[this.idx].hide();
};

PrefabChar6B.prototype.hit = function() {
	this.visible = true;
	this._HIT_FEAR.stop();
	this._HIT.play();
};

PrefabChar6B.prototype.hitDown = function() {
	this.visible = true;
	this._HIT.stop();
	this._HIT_DOWN.play();
};

PrefabChar6B.prototype.fadeOut = function() {
	hole[this.idx] = 0;
	this.visible = false;
	
	// 2017-07-08 add
	this.isIdle = false;
};

PrefabChar6B.prototype.showWordBox = function() {
	this.game.state.getCurrentState().wordPanel.children[this.idx].show(this.charWord);
	
	this._UP.stop();
	this._IDLE.play();
	
	// 190313 add
	// 상태 변경 추가
	this.isIdle = true;
};

PrefabChar6B.prototype.animComplete = function() {
	this.showWordBox();
};

PrefabChar6B.prototype.hide = function() {
	if (mEffectMute == false) {
		esOut.play();
	}
	
	if(itemSpawnTable[this.idx] != 0) {
		gCorrectIndex = this.idx;
		gState = 3; 
	}
	
	this.game.state.getCurrentState().wordPanel.children[this.idx].hide();
	this._IDLE.stop();
	this._DOWN.play();
	
	// 190313 add
	// 상태 변경 추가
	this.isIdle = false;
	
	// 190323 add
	correctWordList[this.idx] = "";
};

PrefabChar6B.prototype.animHideComplete = function() {
	this.game.time.events.remove(this.charEvent);
	
	hole[this.idx] = 0;
	this.visible = false;
};

PrefabChar6B.prototype.cancelEvent = function() {
	if (this._IDLE.isPlaying) {
		this._IDLE.stop();
		
		// 2017-07-08 delete
		// 190313 add
		// 상태 변경 추가
//		this.isIdle = false;
	}
	
	this.game.time.events.remove(this.charEvent);	// ok	
	this._HIT_DOWN.play();
};

PrefabChar6B.prototype.setCharInfo = function(_word) {
	this.charWord = _word;
};
