
// -- user code here --

/* --- start generated code --- */

// Generated by  1.5.3 (Phaser v2.6.2)


/**
 * UserInfoPopup.
 * @param {Phaser.Game} aGame A reference to the currently running game.
 * @param {Phaser.Group} aParent The parent Group (or other {@link DisplayObject}) that this group will be added to.    If undefined/unspecified the Group will be added to the {@link Phaser.Game#world Game World}; if null the Group will not be added to any parent.
 * @param {string} aName A name for this group. Not used internally but useful for debugging.
 * @param {boolean} aAddToStage If true this group will be added directly to the Game.Stage instead of Game.World.
 * @param {boolean} aEnableBody If true all Sprites created with {@link #create} or {@link #createMulitple} will have a physics body created on them. Change the body type with {@link #physicsBodyType}.
 * @param {number} aPhysicsBodyType The physics body type to use when physics bodies are automatically added. See {@link #physicsBodyType} for values.
 */
function UserInfoPopup(aGame, aParent, aName, aAddToStage, aEnableBody, aPhysicsBodyType) {
	
	Phaser.Group.call(this, aGame, aParent, aName, aAddToStage, aEnableBody, aPhysicsBodyType);
	this.game.add.sprite(0.0, 0.0, 'PopPanelFriendInvite', null, this);
	
	var _BtnForcedExit = this.game.add.button(354.5, 401.0, 'BtnForcedExit', fireMen, this, 1, 0, 2, null, this);
	
	var _BtnEntrust = this.game.add.button(154.5, 401.0, 'BtnEntrust', changeMaster, this, 1, 0, 2, null, this);
	
	this.game.add.sprite(191.5, 270.0, 'STitleUserWinningRate', null, this);
	
	this.game.add.sprite(131.5, 35.0, 'TitleSelectUserInfo', null, this);
	
	this.game.add.sprite(131.5, 100.0, 'STitleNickname', null, this);
	
	this.game.add.button(357.0, -30.0, 'BtnExit', offUserInfoPopup, this, 1, 0, 2, null, this);
	
	this.game.add.sprite(58.0, 135.0, 'BarL2', null, this);
	
	this.game.add.sprite(108.0, 305.0, 'BarL2', null, this);
	
	this.game.add.sprite(355.0, 100.0, 'STitleGameReady', null, this);
	
	var _isReady = new MuteControl(this.game, this);
	_isReady.position.setTo(379.0, 154.0);
	
	var _txt_nickname = this.game.add.text(188.0, 157.0, '유저네임여덟글자', {"font":"bold 20px Arial","fill":"#ffffff"}, this);
	_txt_nickname.anchor.setTo(0.5, 0.5);
	
	var _txt_winrate = this.game.add.text(239.0, 327.0, '999승 999무 999패', {"font":"bold 20px Arial","fill":"#ffffff"}, this);
	_txt_winrate.anchor.setTo(0.5, 0.5);
	
	var _mask = this.game.add.button(348.0, 90.0, 'BtnInputTxt', null, this, null, 3, null, null, this);
	_mask.scale.setTo(1.0, 3.0);
	_mask.alpha = 0.0;
	
	var _clan_name = this.game.add.group(this);
	
	this.game.add.sprite(204.5, 185.0, 'STitleClanName', null, _clan_name);
	
	this.game.add.sprite(108.0, 220.0, 'BarL2', null, _clan_name);
	
	var _txt_clanname = this.game.add.text(234.0, 241.0, '빨강', {"font":"bold 20px Arial","fill":"#ffffff","align":"center"}, _clan_name);
	_txt_clanname.anchor.setTo(0.5, 0.5);
	
	var _team_color = this.game.add.group(this);
	
	this.game.add.sprite(183.0, 220.0, 'BarS', null, _team_color);
	
	this.game.add.sprite(204.0, 185.0, 'STitleTeamColor', null, _team_color);
	
	var _txt_color = this.game.add.text(238.0, 242.0, '빨강', {"font":"bold 20px Arial","fill":"#ffffff"}, _team_color);
	_txt_color.anchor.setTo(0.5, 0.5);
	
	var _BtnTeamChange = this.game.add.button(-45.0, 401.0, 'BtnTeamChange', changeTeamColor, this, 1, 0, 2, null, this);
	
	
	
	// fields
	
	this.fBtnForcedExit = _BtnForcedExit;
	this.fBtnEntrust = _BtnEntrust;
	this.fIsReady = _isReady;
	this.fTxt_nickname = _txt_nickname;
	this.fTxt_winrate = _txt_winrate;
	this.fClan_name = _clan_name;
	this.fTxt_clanname = _txt_clanname;
	this.fTeam_color = _team_color;
	this.fTxt_color = _txt_color;
	this.fBtnTeamChange = _BtnTeamChange;
	
	this.roomType = "자유";
	
}

/** @type Phaser.Group */
var UserInfoPopup_proto = Object.create(Phaser.Group.prototype);
UserInfoPopup.prototype = UserInfoPopup_proto;
UserInfoPopup.prototype.constructor = UserInfoPopup;

/* --- end generated code --- */
// -- user code here --

UserInfoPopup.prototype.init = function(data, roomType) {
	this.fTxt_nickname.setText(data.NICKNAME);
	this.fIsReady.setValue(data.READY);
	this.roomType = roomType;
	console.log(data);
	
	if(roomType == '자유') {
		this.originTeam = data.TEAM;
		this.fTxt_color.setText((data.TEAM=='RED')?'빨강':'파랑');
		this.fTeam_color.visible = true;
		this.fClan_name.visible = false;
	}
	else {
		this.fTxt_clanname.setText(data.CLAN);
		this.fTeam_color.visible = false;
		this.fClan_name.visible = true;
		this.fBtnTeamChange.visible = false;
		this.fBtnForcedExit.position.x = 265;
		this.fBtnEntrust.position.x = 45;
	}
	
	this.fTxt_winrate.setText(data.RESULT.win + '승 ' + data.RESULT.draw +'무 ' + data.RESULT.lose + '패');
};

var offUserInfoPopup = function(obj) {
	obj.game.audioManager.playSfx("Click");

	obj.game.popupManager.closePopup("userInfo");
	obj.parent.destroy();
};

var changeMaster = function(obj) {
	obj.game.audioManager.playSfx("Click");
	
	for(var i = 0 ; i < obj.game.robbyManager.scene.redUsers.length ; i++) {
		if(obj.game.robbyManager.scene.redUsers[i].children[0].selected) {
			obj.game.socketManager.changeMaster(obj.game.userInfoManager.robby_red[i]);
			obj.game.popupManager.closePopup("userInfo");
			obj.parent.destroy();
			return;
		}
	}
	for(var i = 0 ; i < obj.game.robbyManager.scene.blueUsers.length ; i++) {
		if(obj.game.robbyManager.scene.blueUsers[i].children[0].selected) {
			obj.game.socketManager.changeMaster(obj.game.userInfoManager.robby_blue[i]);
			obj.game.popupManager.closePopup("userInfo");
			obj.parent.destroy();
			return;
		}
	}
	obj.game.popupManager.closePopup("userInfo");
	obj.parent.destroy();
};

var fireMen = function(obj) {
	obj.game.audioManager.playSfx("Click");
	
	for(var i = 0 ; i < obj.game.robbyManager.scene.redUsers.length ; i++) {
		if(obj.game.robbyManager.scene.redUsers[i].children[0].selected) {
			obj.game.socketManager.fireMen(obj.game.userInfoManager.robby_red[i]);
			obj.game.popupManager.closePopup("userInfo");
			obj.parent.destroy();
			return;
		}
	}
	for(var i = 0 ; i < obj.game.robbyManager.scene.blueUsers.length ; i++) {
		if(obj.game.robbyManager.scene.blueUsers[i].children[0].selected) {
			obj.game.socketManager.fireMen(obj.game.userInfoManager.robby_blue[i]);
			obj.game.popupManager.closePopup("userInfo");
			obj.parent.destroy();
			return;
		}
	}
	obj.game.popupManager.closePopup("userInfo");
	obj.parent.destroy();
};

var changeTeamColor = function(obj) {
	for(var i = 0 ; i < obj.game.robbyManager.scene.redUsers.length ; i++) {
		if(obj.game.robbyManager.scene.redUsers[i].children[0].selected) {
			obj.game.socketManager.moveOtherTeam(obj.game.userInfoManager.robby_red[i]);
			obj.game.popupManager.closePopup("userInfo");
			obj.parent.destroy();
			return;
		}
	}
	for(var i = 0 ; i < obj.game.robbyManager.scene.blueUsers.length ; i++) {
		if(obj.game.robbyManager.scene.blueUsers[i].children[0].selected) {
			obj.game.socketManager.moveOtherTeam(obj.game.userInfoManager.robby_blue[i]);
			obj.game.popupManager.closePopup("userInfo");
			obj.parent.destroy();
			return;
		}
	}
	obj.game.popupManager.closePopup("userInfo");
	obj.parent.destroy();
};